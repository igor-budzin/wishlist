# Localization (i18n) Guide

This application uses i18next for internationalization. Translation files are stored in the shared package and used by both frontend and backend.

## Structure

```
packages/shared/i18n/
‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îú‚îÄ‚îÄ en/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common.json      # UI texts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors.json      # API errors
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.json  # Form/schema validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ landing.json     # Landing page texts
‚îÇ   ‚îî‚îÄ‚îÄ uk/
‚îÇ       ‚îú‚îÄ‚îÄ common.json
‚îÇ       ‚îú‚îÄ‚îÄ errors.json
‚îÇ       ‚îú‚îÄ‚îÄ validation.json
‚îÇ       ‚îî‚îÄ‚îÄ landing.json
‚îú‚îÄ‚îÄ types.ts                 # TypeScript types
‚îî‚îÄ‚îÄ index.ts                 # Exports
```

## Supported Languages

- `en` - English (default)
- `uk` - Ukrainian

## Translation Namespaces

### common

UI texts, buttons, labels, messages

- `common.save` - "Save"
- `common.cancel` - "Cancel"
- `common.item.title` - "Title"
- `common.message.itemAdded` - "Item added successfully!"

### errors

Backend API error messages

- `errors.notFound` - "Resource not found"
- `errors.wishlist.itemNotFound` - "Wishlist item not found"
- `errors.auth.providerConflict` - Provider conflict error

### validation

Form and schema validation messages

- `validation.title.required` - "Title is required"
- `validation.url.invalid` - "Must be a valid URL"
- `validation.price.invalid` - Price format error

### landing

Landing page texts (used by the `@wishlist/landing` package)

- `landing.hero.title` - Hero section title
- `landing.features.title` - Features section title
- `landing.footer.brandName` - Brand name in footer
- `landing.nav.logIn` - Navigation login button
- `landing.about.*` - About page content (mission, values, story, contact)
- `landing.privacyPolicy.*` - Privacy Policy page content
- `landing.termsOfService.*` - Terms of Service page content

## Language Flow

### Frontend (React App)

1. User's language is stored in `localStorage` under key `"lang"`
2. Language detection order: localStorage ‚Üí browser navigator
3. Language is sent to backend via `Accept-Language` header
4. All API requests include the current language

### Landing Page (Astro)

1. Language is auto-detected from localStorage or browser navigator
2. HTML `lang` attribute is set dynamically via inline script
3. User can manually change language via footer language switcher
4. Language preference is persisted to `localStorage` under key `"lang"`

### Backend

1. Language is detected from `Accept-Language` header ONLY
2. Middleware attaches `req.language` and `req.t()` to all requests
3. Error messages and validation use translation keys
4. Backend returns error CODES, not translated text

## Usage

### Frontend (React Components)

```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t('common.appName')}</h1>
      <button>{t('common.save')}</button>

      {/* With interpolation */}
      <p>{t('common.message.loginWith', { provider: 'Google' })}</p>
    </div>
  );
}
```

### Frontend (Validation Schemas)

Validation schemas use translation keys. The custom error map automatically translates them:

```ts
import { z } from 'zod';

const schema = z.object({
  title: z.string().min(1, 'validation.title.required'),
  url: z.string().url('validation.url.invalid'),
});
```

### Backend (Controllers)

```ts
async getById(req: Request, res: Response, next: NextFunction) {
  try {
    const item = await this.service.getItemById(id, userId);
    res.json({ success: true, data: item });
  } catch (error) {
    // Return translation key
    res.status(404).json({
      success: false,
      error: req.t('errors.wishlist.itemNotFound')
    });
  }
}
```

### Backend (Validation Schemas)

```ts
import { z } from 'zod';

const schema = z.object({
  title: z.string().min(1, 'validation.title.required'),
  url: z.string().url('validation.url.invalid'),
});
```

The validation middleware automatically translates error messages using `req.t()`.

## Adding New Translations

### 1. Add translation keys to JSON files

[packages/shared/i18n/locales/en/common.json](packages/shared/i18n/locales/en/common.json):

```json
{
  "newFeature": {
    "title": "New Feature",
    "description": "This is a new feature"
  }
}
```

[packages/shared/i18n/locales/uk/common.json](packages/shared/i18n/locales/uk/common.json):

```json
{
  "newFeature": {
    "title": "–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è",
    "description": "–¶–µ –Ω–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è"
  }
}
```

### 2. Use in code

Frontend:

```tsx
const { t } = useTranslation();
<h1>{t('common.newFeature.title')}</h1>;
```

Backend:

```ts
const message = req.t('common.newFeature.title');
```

## Translation Key Conventions

- **Use dot notation**: `common.item.addNew`
- **Use semantic names**: Describe WHAT, not WHERE
  - ‚úÖ `validation.email.invalid`
  - ‚ùå `loginForm.emailError`
- **Group related keys**: Use nested objects
  ```json
  {
    "item": {
      "title": "Title",
      "description": "Description",
      "addNew": "Add New Item"
    }
  }
  ```
- **Reuse keys**: Don't duplicate common terms
  - Use `common.save` everywhere instead of creating `item.save`, `profile.save`, etc.

## Interpolation

Use `{{variable}}` syntax for dynamic values:

JSON:

```json
{
  "welcome": "Welcome, {{name}}!",
  "itemCount": "You have {{count}} items"
}
```

Usage:

```tsx
t('common.welcome', { name: 'John' });
// => "Welcome, John!"

t('common.itemCount', { count: 5 });
// => "You have 5 items"
```

## Changing Language

Frontend:

```tsx
import { useTranslation } from 'react-i18next';

function LanguageSwitcher() {
  const { i18n } = useTranslation();

  const changeLanguage = (lang: string) => {
    i18n.changeLanguage(lang); // Automatically saves to localStorage
  };

  return (
    <select onChange={(e) => changeLanguage(e.target.value)} value={i18n.language}>
      <option value="en">English</option>
      <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
    </select>
  );
}
```

## TypeScript Support

Translation keys are fully typed:

```ts
// ‚úÖ TypeScript knows these keys exist
t('common.save');
t('errors.wishlist.itemNotFound');
t('validation.title.required');

// ‚ùå TypeScript error for invalid keys
t('common.invalidKey'); // Error!
```

## Important Rules

### ‚úÖ DO

- Use translation keys for ALL user-facing text
- Use stable, semantic key names
- Test with both languages
- Keep translations synchronized across en/uk files
- Use interpolation for dynamic content

### ‚ùå DON'T

- Hardcode user-facing strings
- Return translated text from backend (return codes instead)
- Create duplicate keys for the same text
- Use translation keys as code logic (they're for display only)
- Change existing keys (breaks translations)

## Testing

```tsx
import { render } from '@testing-library/react';
import { I18nextProvider } from 'react-i18next';
import i18n from '../lib/i18n';

test('renders with translation', () => {
  const { getByText } = render(
    <I18nextProvider i18n={i18n}>
      <MyComponent />
    </I18nextProvider>
  );

  expect(getByText('Save')).toBeInTheDocument();
});
```

## Common Patterns

### Conditional translations

```tsx
// For status-based messages
t(`common.status.${status}`); // status: 'active' | 'pending' | 'completed'
```

### Pluralization

```json
{
  "items": "{{count}} item",
  "items_other": "{{count}} items"
}
```

```tsx
t('common.items', { count: 1 }); // "1 item"
t('common.items', { count: 5 }); // "5 items"
```

### Error handling

```tsx
// Backend returns error code
const { error } = await api.createItem(data);

// Frontend translates it
if (error) {
  toast.error(t(error)); // error is "errors.wishlist.itemNotFound"
}
```

## Troubleshooting

### Translation not appearing

1. Check that the key exists in the JSON file
2. Verify you're using the correct namespace
3. Check browser console for i18next warnings
4. Ensure i18n is initialized before rendering

### Backend not translating

1. Verify `languageMiddleware` is added to Express app
2. Check that `Accept-Language` header is being sent
3. Ensure i18n is initialized in server.ts before app starts
4. Check that translation files are being loaded (check logs)

### Keys showing instead of translations

1. The translation key doesn't exist - add it to JSON files
2. Wrong namespace - check namespace in translation files
3. i18n not initialized - ensure `initI18n()` is called

## Migration Status

### ‚úÖ Completed

- Backend i18n configuration
- Frontend i18n configuration
- Accept-Language header integration
- Validation schemas (frontend & backend)
- Backend error responses
- API client language headers
- Sample component (BackButton)
- **Landing page i18n (full)**
  - Auto-detection from localStorage/browser
  - Manual language switcher in footer
  - All components translated (Hero, Features, HowItWorks, SeeInAction, FAQ, CTA, Footer)
  - About page fully localized (mission, values, story, contact sections)
  - Privacy Policy page fully localized (all 10 sections)
  - Terms of Service page fully localized (all 14 sections)

### üöß To Complete

Convert remaining frontend components to use `t()` function:

- All page components (HomePage, AddItemPage, EditItemPage, etc.)
- Form components (ItemForm, etc.)
- UI components with hardcoded text
- Toast messages in WishlistContext
- Auth-related components

### Example conversion pattern

**Before:**

```tsx
<Button>Add Item</Button>
```

**After:**

```tsx
const { t } = useTranslation();
<Button>{t('common.item.addItem')}</Button>;
```

## Resources

- [i18next Documentation](https://www.i18next.com/)
- [react-i18next Documentation](https://react.i18next.com/)
- [i18next-fs-backend Documentation](https://github.com/i18next/i18next-fs-backend)
